# Conifguration file for configure SLURM resource manager for CEEMS API server
---
ceems_api_server:
  data:
    path: TO_REPLACE
    backup_path: TO_REPLACE
    # backup_interval: 10s
    # update_from: '2024-09-08T00:00:00Z'
  admin:
    users:
      - grafana
  web:
    requests_limit: 30
clusters:
  - id: slurm-0
    manager: slurm
    updaters:
      - tsdb-0
      - tsdb-1
    cli: 
      path: pkg/api/testdata

  - id: slurm-1
    manager: slurm
    updaters:
      - tsdb-0
    cli: 
      path: pkg/api/testdata

updaters:
  - id: tsdb-0
    updater: tsdb
    web:
      url: http://localhost:9090
    extra_config:
      cutoff_duration: 0s
      query_batch_size: 1
      queries:
        # Average CPU utilisation
        avg_cpu_usage: 
          global: avg_cpu_usage{uuid=~"{{.UUIDs}}"}

        # Average CPU Memory utilisation
        avg_cpu_mem_usage: 
          global: avg_cpu_mem_usage{uuid=~"{{.UUIDs}}"}

        # Total CPU energy usage in kWh
        total_cpu_energy_usage_kwh: 
          total: total_cpu_energy_usage_kwh{uuid=~"{{.UUIDs}}"}

        # Total CPU emissions in gms
        total_cpu_emissions_gms: 
          rte_total: total_cpu_emissions_gms{uuid=~"{{.UUIDs}}",provider="rte"}
          emaps_total: total_cpu_emissions_gms{uuid=~"{{.UUIDs}}",provider="emaps"}

        # Average GPU utilization
        avg_gpu_usage: 
          global: avg_gpu_usage{uuid=~"{{.UUIDs}}"}

        # Average GPU memory utilization
        avg_gpu_mem_usage: 
          global: avg_gpu_mem_usage{uuid=~"{{.UUIDs}}"}

        # Total GPU energy usage in kWh
        total_gpu_energy_usage_kwh: 
          total: total_gpu_energy_usage_kwh{uuid=~"{{.UUIDs}}"}

        # Total GPU emissions in gms
        total_gpu_emissions_gms: 
          rte_total: total_cpu_emissions_gms{uuid=~"{{.UUIDs}}",provider="rte"}
          emaps_total: total_cpu_emissions_gms{uuid=~"{{.UUIDs}}",provider="emaps"}

  - id: tsdb-1
    updater: tsdb
    web:
      url: http://localhost:9090
    extra_config:
      cutoff_duration: 0s
      query_batch_size: 1
      queries:
        # Total IO Read stats
        total_io_read_stats: 
          bytes: total_io_read_stats_bytes{uuid=~"{{.UUIDs}}"}
          requests: total_io_read_stats_requests{uuid=~"{{.UUIDs}}"}

        # Total IO Write stats
        total_io_write_stats: 
          bytes: total_io_write_stats_bytes{uuid=~"{{.UUIDs}}"}
          requests: total_io_write_stats_requests{uuid=~"{{.UUIDs}}"}

        # Total Ingress stats
        total_ingress_stats: 
          bytes: total_ingress_stats_bytes{uuid=~"{{.UUIDs}}"}
          packets: total_ingress_stats_packets{uuid=~"{{.UUIDs}}"}

        # Total Outgress stats
        total_outgress_stats: 
          bytes: total_outgress_stats_bytes{uuid=~"{{.UUIDs}}"}
          packets: total_outgress_stats_packets{uuid=~"{{.UUIDs}}"}
